import e from"@babel/runtime/helpers/esm/extends";import t,{createContext as n,useContext as i,useMemo as r,useRef as a,useLayoutEffect as s,useState as o,useCallback as l}from"react";import c from"yoga-layout-wasm";import{Group as g}from"react-konva";let d;async function m(e){d=await c.init(e)}const p=e=>e[0].toUpperCase()+e.slice(1),u=e=>e.toUpperCase().replace("-","_"),h=(e,t,n)=>Object.keys(t).forEach((i=>{const r=t[i];if("string"==typeof r)switch(i){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(d[`FLEX_DIRECTION_${u(r)}`]);case"align":case"alignItems":return e.setAlignItems(d[`ALIGN_${u(r)}`]);case"justify":case"justifyContent":return e.setJustifyContent(d[`JUSTIFY_${u(r)}`]);case"wrap":case"flexWrap":return e.setFlexWrap(d[`WRAP_${u(r)}`]);case"basis":case"flexBasis":return e.setFlexBasis(r);default:return e[`set${p(i)}`](r)}else if("number"==typeof r){const t=r*n;switch(i){case"basis":case"flexBasis":return e.setFlexBasis(t);case"grow":case"flexGrow":return e.setFlexGrow(t);case"shrink":case"flexShrink":return e.setFlexShrink(t);case"align":return e.setAlignItems(r);case"justify":return e.setJustifyContent(r);case"flexDir":case"dir":return e.setFlexDirection(r);case"wrap":return e.setFlexWrap(r);case"padding":case"p":return e.setPadding(d.EDGE_ALL,t);case"paddingLeft":case"pl":return e.setPadding(d.EDGE_LEFT,t);case"paddingRight":case"pr":return e.setPadding(d.EDGE_RIGHT,t);case"paddingTop":case"pt":return e.setPadding(d.EDGE_TOP,t);case"paddingBottom":case"pb":return e.setPadding(d.EDGE_BOTTOM,t);case"margin":case"m":return e.setMargin(d.EDGE_ALL,t);case"marginLeft":case"ml":return e.setMargin(d.EDGE_LEFT,t);case"marginRight":case"mr":return e.setMargin(d.EDGE_RIGHT,t);case"marginTop":case"mt":return e.setMargin(d.EDGE_TOP,t);case"marginBottom":case"mb":return e.setMargin(d.EDGE_BOTTOM,t);default:return e[`set${p(i)}`](t)}}}));const f=e=>Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{})),x=n({scaleFactor:100,requestReflow(){console.warn("Flex not initialized! Please report")},registerBox(){console.warn("Flex not initialized! Please report")},unregisterBox(){console.warn("Flex not initialized! Please report")}}),w=n({node:null,size:[0,0]});function y(e){let t=i(e);return t||console.warn("You must place this hook/component under a <Flex/> component!"),t}function E(){const{requestReflow:e}=y(x);return e}function b(){const{size:e}=y(w);return e}function C(n){let{children:i,centerAnchor:l,flexDirection:c,flexDir:m,dir:p,alignContent:u,alignItems:b,alignSelf:C,align:D,justifyContent:T,justify:B,flexBasis:R,basis:L,flexGrow:F,grow:W,flexShrink:G,shrink:I,flexWrap:_,wrap:k,margin:P,m:v,marginBottom:H,marginLeft:j,marginRight:M,marginTop:O,mb:S,ml:z,mr:A,mt:N,padding:$,p:q,paddingBottom:J,paddingLeft:U,paddingRight:Y,paddingTop:X,pb:K,pl:Q,pr:V,pt:Z,height:ee,width:te,maxHeight:ne,maxWidth:ie,minHeight:re,minWidth:ae,...se}=n;const oe=r((()=>{const e={flexDirection:c,flexDir:m,dir:p,alignContent:u,alignItems:b,alignSelf:C,align:D,justifyContent:T,justify:B,flexBasis:R,basis:L,flexGrow:F,grow:W,flexShrink:G,shrink:I,flexWrap:_,wrap:k,margin:P,m:v,marginBottom:H,marginLeft:j,marginRight:M,marginTop:O,mb:S,ml:z,mr:A,mt:N,padding:$,p:q,paddingBottom:J,paddingLeft:U,paddingRight:Y,paddingTop:X,pb:K,pl:Q,pr:V,pt:Z,height:ee,width:te,maxHeight:ne,maxWidth:ie,minHeight:re,minWidth:ae};return f(e),e}),[D,u,b,C,p,R,L,m,c,F,W,G,I,_,ee,B,T,v,P,H,j,M,O,ne,ie,S,re,ae,z,A,N,q,$,J,U,Y,X,K,Q,V,Z,te,k]),{registerBox:le,unregisterBox:ce,scaleFactor:ge}=y(x),{node:de}=y(w),me=a(null),pe=r((()=>d.Node.create()),[]),ue=E();s((()=>{h(pe,oe,ge)}),[oe,pe,ge]),s((()=>{if(me.current&&de)return de.insertChild(pe,de.getChildCount()),le(pe,me.current,oe,l),()=>{de.removeChild(pe),ce(pe)}}),[pe,de,oe,l,le,ce]),s((()=>{ue()}),[i,oe,ue]);const[he,fe]=o([0,0]),xe=1/ge;s((()=>{const e=("number"==typeof oe.width?oe.width:null)||pe.getComputedWidth().valueOf()/ge,t=("number"==typeof oe.height?oe.height:null)||pe.getComputedHeight().valueOf()/ge;(Math.abs(e-he[0])>xe||Math.abs(t-he[1])>xe)&&fe([e,t])}),[xe,oe.height,oe.width,pe,ge,he]);const we=r((()=>({node:pe,size:he})),[pe,he]);return t.createElement(g,e({ref:me},se),t.createElement(w.Provider,{value:we},"function"==typeof i?i(he[0],he[1]):i))}function D(e){let{size:n=[1,1,1],yogaDirection:i="ltr",plane:c="xy",children:m,scaleFactor:p=100,onReflow:u,flexDirection:y,flexDir:E,dir:b,alignContent:C,alignItems:D,alignSelf:T,align:B,justifyContent:R,justify:L,flexBasis:F,basis:W,flexGrow:G,grow:I,flexShrink:_,shrink:k,flexWrap:P,wrap:v,margin:H,m:j,marginBottom:M,marginLeft:O,marginRight:S,marginTop:z,mb:A,ml:N,mr:$,mt:q,padding:J,p:U,paddingBottom:Y,paddingLeft:X,paddingRight:K,paddingTop:Q,pb:V,pl:Z,pr:ee,pt:te,height:ne,width:ie,maxHeight:re,maxWidth:ae,minHeight:se,minWidth:oe,...le}=e;const ce=r((()=>{const e={flexDirection:y,flexDir:E,dir:b,alignContent:C,alignItems:D,alignSelf:T,align:B,justifyContent:R,justify:L,flexBasis:F,basis:W,flexGrow:G,grow:I,flexShrink:_,shrink:k,flexWrap:P,wrap:v,margin:H,m:j,marginBottom:M,marginLeft:O,marginRight:S,marginTop:z,mb:A,ml:N,mr:$,mt:q,padding:J,p:U,paddingBottom:Y,paddingLeft:X,paddingRight:K,paddingTop:Q,pb:V,pl:Z,pr:ee,pt:te,height:ne,width:ie,maxHeight:re,maxWidth:ae,minHeight:se,minWidth:oe};return f(e),e}),[B,C,D,T,b,F,W,E,y,G,I,_,k,P,ne,L,R,j,H,M,O,S,z,re,ae,A,se,oe,N,$,q,U,J,Y,X,K,Q,V,Z,ee,te,ie,v]),ge=a([]),de=l((function(e,t,n,i){void 0===i&&(i=!1);const r=ge.current.findIndex((t=>t.node===e));-1!==r&&ge.current.splice(r,1),ge.current.push({group:t,node:e,flexProps:n,centerAnchor:i})}),[]),me=l((e=>{const t=ge.current.findIndex((t=>t.node===e));-1!==t&&ge.current.splice(t,1)}),[]),pe=r((()=>d.Node.create()),[]);s((()=>{h(pe,ce,p)}),[pe,ce,p]);const[ue,he]=o(0),fe=l((()=>{}),[]),xe=a(0),we=a(!1);s((()=>{we.current=!1,xe.current+=1}));const ye=l((()=>{we.current||(we.current=!0,he((e=>e+1)),fe())}),[fe]);s((()=>{ye()}),[m,ce,ye]);const[Ee,be]=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(n,c),Ce="ltr"===i?d.DIRECTION_LTR:"rtl"===i?d.DIRECTION_RTL:i,De=r((()=>({requestReflow:ye,registerBox:de,unregisterBox:me,scaleFactor:p})),[ye,de,me,p]),Te=r((()=>({node:pe,size:[Ee,be]})),[pe,Ee,be]);return s((()=>{!function(){const e=Array(ge.current.length);ge.current.forEach(((t,n)=>{let{group:i,node:r,flexProps:a}=t;const s="number"==typeof a.width?a.width*p:a.width,o="number"==typeof a.height?a.height*p:a.height;if(void 0!==s&&void 0!==o)r.setWidth(s),r.setHeight(o);else if(0===r.getChildCount()){const t=i.getClientRect({skipTransform:!0});e[n]=t,r.setWidth(s||t.width*p),r.setHeight(o||t.height*p)}else r.setWidth(NaN),r.setHeight(NaN)})),pe.calculateLayout(Ee*p,be*p,Ce);let t=0,n=0,i=0,r=0;ge.current.forEach(((a,s)=>{let{group:o,node:l,centerAnchor:c}=a;const{left:g,top:d,width:m,height:u}=l.getComputedLayout();let h=0,f=0;const x=e[s];x&&(h=x.x,f=x.y);const w={x:(g+(c?m/2:0))/p,y:(d+(c?u/2:0))/p};w.x-=h,w.y-=f,t=Math.min(t,g),i=Math.min(i,d),n=Math.max(n,g+m),r=Math.max(r,d+u),o.position(w)})),u&&u((n-t)/p,(r-i)/p)}()}),[ue]),t.createElement(g,le,t.createElement(x.Provider,{value:De},t.createElement(w.Provider,{value:Te},m)))}export{C as Box,D as Flex,m as initKonvaFlex,y as useContext,b as useFlexSize,E as useReflow};
