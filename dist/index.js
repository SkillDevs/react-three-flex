import e from"@babel/runtime/helpers/esm/extends";import t,{createContext as n,useContext as i,useMemo as r,useRef as a,useLayoutEffect as s,useState as o,useCallback as l}from"react";import c from"yoga-layout-prebuilt";import{Group as g}from"react-konva";const d=e=>e[0].toUpperCase()+e.slice(1),m=e=>e.toUpperCase().replace("-","_"),p=(e,t,n)=>Object.keys(t).forEach((i=>{const r=t[i];if("string"==typeof r)switch(i){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(c[`FLEX_DIRECTION_${m(r)}`]);case"align":case"alignItems":return e.setAlignItems(c[`ALIGN_${m(r)}`]);case"justify":case"justifyContent":return e.setJustifyContent(c[`JUSTIFY_${m(r)}`]);case"wrap":case"flexWrap":return e.setFlexWrap(c[`WRAP_${m(r)}`]);case"basis":case"flexBasis":return e.setFlexBasis(r);default:return e[`set${d(i)}`](r)}else if("number"==typeof r){const t=r*n;switch(i){case"basis":case"flexBasis":return e.setFlexBasis(t);case"grow":case"flexGrow":return e.setFlexGrow(t);case"shrink":case"flexShrink":return e.setFlexShrink(t);case"align":return e.setAlignItems(r);case"justify":return e.setJustifyContent(r);case"flexDir":case"dir":return e.setFlexDirection(r);case"wrap":return e.setFlexWrap(r);case"padding":case"p":return e.setPadding(c.EDGE_ALL,t);case"paddingLeft":case"pl":return e.setPadding(c.EDGE_LEFT,t);case"paddingRight":case"pr":return e.setPadding(c.EDGE_RIGHT,t);case"paddingTop":case"pt":return e.setPadding(c.EDGE_TOP,t);case"paddingBottom":case"pb":return e.setPadding(c.EDGE_BOTTOM,t);case"margin":case"m":return e.setMargin(c.EDGE_ALL,t);case"marginLeft":case"ml":return e.setMargin(c.EDGE_LEFT,t);case"marginRight":case"mr":return e.setMargin(c.EDGE_RIGHT,t);case"marginTop":case"mt":return e.setMargin(c.EDGE_TOP,t);case"marginBottom":case"mb":return e.setMargin(c.EDGE_BOTTOM,t);default:return e[`set${d(i)}`](t)}}}));const u=e=>Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{})),h=n({scaleFactor:100,requestReflow(){console.warn("Flex not initialized! Please report")},registerBox(){console.warn("Flex not initialized! Please report")},unregisterBox(){console.warn("Flex not initialized! Please report")}}),f=n({node:null,size:[0,0],rebuildFlag:0});function x(e){let t=i(e);return t||console.warn("You must place this hook/component under a <Flex/> component!"),t}function w(){const{requestReflow:e}=x(h);return e}function E(){const{size:e}=x(f);return e}function y(n){let{children:i,centerAnchor:l,flexDirection:d,flexDir:m,dir:E,alignContent:y,alignItems:b,alignSelf:D,align:C,justifyContent:T,justify:B,flexBasis:F,basis:R,flexGrow:L,grow:I,flexShrink:W,shrink:G,flexWrap:_,wrap:k,margin:P,m:v,marginBottom:H,marginLeft:j,marginRight:M,marginTop:O,mb:S,ml:z,mr:A,mt:N,padding:$,p:q,paddingBottom:J,paddingLeft:U,paddingRight:Y,paddingTop:X,pb:K,pl:Q,pr:V,pt:Z,height:ee,width:te,maxHeight:ne,maxWidth:ie,minHeight:re,minWidth:ae,...se}=n;const oe=r((()=>{const e={flexDirection:d,flexDir:m,dir:E,alignContent:y,alignItems:b,alignSelf:D,align:C,justifyContent:T,justify:B,flexBasis:F,basis:R,flexGrow:L,grow:I,flexShrink:W,shrink:G,flexWrap:_,wrap:k,margin:P,m:v,marginBottom:H,marginLeft:j,marginRight:M,marginTop:O,mb:S,ml:z,mr:A,mt:N,padding:$,p:q,paddingBottom:J,paddingLeft:U,paddingRight:Y,paddingTop:X,pb:K,pl:Q,pr:V,pt:Z,height:ee,width:te,maxHeight:ne,maxWidth:ie,minHeight:re,minWidth:ae};return u(e),e}),[C,y,b,D,E,F,R,m,d,L,I,W,G,_,ee,B,T,v,P,H,j,M,O,ne,ie,S,re,ae,z,A,N,q,$,J,U,Y,X,K,Q,V,Z,te,k]),{registerBox:le,unregisterBox:ce,scaleFactor:ge}=x(h),{node:de,rebuildFlag:me}=x(f),pe=a(null),ue=r((()=>c.Node.create()),[]),he=w();s((()=>{p(ue,oe,ge)}),[oe,ue,ge]),s((()=>{if(pe.current&&de)return de.insertChild(ue,de.getChildCount()),le(ue,pe.current,oe,l),()=>{de.removeChild(ue),ce(ue)}}),[ue,de,oe,l,le,ce,me]),s((()=>{he()}),[oe,he,me]);const[fe,xe]=o([0,0]),we=1/ge;s((()=>{const e=("number"==typeof oe.width?oe.width:null)||ue.getComputedWidth().valueOf()/ge,t=("number"==typeof oe.height?oe.height:null)||ue.getComputedHeight().valueOf()/ge;(Math.abs(e-fe[0])>we||Math.abs(t-fe[1])>we)&&xe([e,t])}),[we,oe.height,oe.width,ue,ge,fe]);const Ee=r((()=>({node:ue,size:fe,rebuildFlag:Date.now()})),[ue,fe,i]);return t.createElement(g,e({ref:pe},se),t.createElement(f.Provider,{value:Ee},"function"==typeof i?i(fe[0],fe[1]):i))}function b(e){let{size:n=[1,1,1],yogaDirection:i="ltr",plane:d="xy",children:m,scaleFactor:x=100,onReflow:w,flexDirection:E,flexDir:y,dir:b,alignContent:D,alignItems:C,alignSelf:T,align:B,justifyContent:F,justify:R,flexBasis:L,basis:I,flexGrow:W,grow:G,flexShrink:_,shrink:k,flexWrap:P,wrap:v,margin:H,m:j,marginBottom:M,marginLeft:O,marginRight:S,marginTop:z,mb:A,ml:N,mr:$,mt:q,padding:J,p:U,paddingBottom:Y,paddingLeft:X,paddingRight:K,paddingTop:Q,pb:V,pl:Z,pr:ee,pt:te,height:ne,width:ie,maxHeight:re,maxWidth:ae,minHeight:se,minWidth:oe,...le}=e;const ce=r((()=>{const e={flexDirection:E,flexDir:y,dir:b,alignContent:D,alignItems:C,alignSelf:T,align:B,justifyContent:F,justify:R,flexBasis:L,basis:I,flexGrow:W,grow:G,flexShrink:_,shrink:k,flexWrap:P,wrap:v,margin:H,m:j,marginBottom:M,marginLeft:O,marginRight:S,marginTop:z,mb:A,ml:N,mr:$,mt:q,padding:J,p:U,paddingBottom:Y,paddingLeft:X,paddingRight:K,paddingTop:Q,pb:V,pl:Z,pr:ee,pt:te,height:ne,width:ie,maxHeight:re,maxWidth:ae,minHeight:se,minWidth:oe};return u(e),e}),[B,D,C,T,b,L,I,y,E,W,G,_,k,P,ne,R,F,j,H,M,O,S,z,re,ae,A,se,oe,N,$,q,U,J,Y,X,K,Q,V,Z,ee,te,ie,v]),ge=a([]),de=l((function(e,t,n,i){void 0===i&&(i=!1);const r=ge.current.findIndex((t=>t.node===e));-1!==r&&ge.current.splice(r,1),ge.current.push({group:t,node:e,flexProps:n,centerAnchor:i})}),[]),me=l((e=>{const t=ge.current.findIndex((t=>t.node===e));-1!==t&&ge.current.splice(t,1)}),[]),pe=r((()=>c.Node.create()),[]);s((()=>{p(pe,ce,x)}),[pe,ce,x]);const[ue,he]=o(0),fe=l((()=>{console.log("Invalidate")}),[]),xe=l((()=>{fe()}),[fe,ue]);s((()=>{xe()}),[m,ce,xe]);const[we,Ee]=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(n,d),ye="ltr"===i?c.DIRECTION_LTR:"rtl"===i?c.DIRECTION_RTL:i,be=r((()=>({requestReflow:xe,registerBox:de,unregisterBox:me,scaleFactor:x})),[xe,de,me,x]),De=r((()=>({node:pe,size:[we,Ee],rebuildFlag:Date.now()})),[pe,we,Ee,m]);return s((()=>{!function(){const e=Array(ge.current.length);ge.current.forEach(((t,n)=>{let{group:i,node:r,flexProps:a}=t;const s="number"==typeof a.width?a.width*x:a.width,o="number"==typeof a.height?a.height*x:a.height;if(void 0!==s&&void 0!==o)r.setWidth(s),r.setHeight(o);else if(0===r.getChildCount()){const t=i.getClientRect({skipTransform:!0});e[n]=t,r.setWidth(s||t.width*x),r.setHeight(o||t.height*x)}else r.setWidth(NaN),r.setHeight(NaN)})),pe.calculateLayout(we*x,Ee*x,ye);let t=0,n=0,i=0,r=0;ge.current.forEach(((a,s)=>{let{group:o,node:l,centerAnchor:c}=a;const{left:g,top:d,width:m,height:p}=l.getComputedLayout();let u=0,h=0;const f=e[s];f&&(u=f.x,h=f.y);const w={x:(g+(c?m/2:0))/x,y:(d+(c?p/2:0))/x};w.x-=u,w.y-=h,t=Math.min(t,g),i=Math.min(i,d),n=Math.max(n,g+m),r=Math.max(r,d+p),o.position(w)})),w&&w((n-t)/x,(r-i)/x),fe()}()}),[m,ce]),t.createElement(g,le,t.createElement(h.Provider,{value:be},t.createElement(f.Provider,{value:De},m)))}export{y as Box,b as Flex,x as useContext,E as useFlexSize,w as useReflow};
