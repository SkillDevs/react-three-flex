import e from"@babel/runtime/helpers/esm/extends";import t,{createContext as n,useContext as i,useMemo as r,useRef as a,useLayoutEffect as s,useState as o,useCallback as l}from"react";import c from"yoga-layout-prebuilt";import{Group as g}from"react-konva";const d=e=>e[0].toUpperCase()+e.slice(1),m=e=>e.toUpperCase().replace("-","_"),p=(e,t,n)=>Object.keys(t).forEach((i=>{const r=t[i];if("string"==typeof r)switch(i){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(c[`FLEX_DIRECTION_${m(r)}`]);case"align":case"alignItems":return e.setAlignItems(c[`ALIGN_${m(r)}`]);case"justify":case"justifyContent":return e.setJustifyContent(c[`JUSTIFY_${m(r)}`]);case"wrap":case"flexWrap":return e.setFlexWrap(c[`WRAP_${m(r)}`]);case"basis":case"flexBasis":return e.setFlexBasis(r);default:return e[`set${d(i)}`](r)}else if("number"==typeof r){const t=r*n;switch(i){case"basis":case"flexBasis":return e.setFlexBasis(t);case"grow":case"flexGrow":return e.setFlexGrow(t);case"shrink":case"flexShrink":return e.setFlexShrink(t);case"align":return e.setAlignItems(r);case"justify":return e.setJustifyContent(r);case"flexDir":case"dir":return e.setFlexDirection(r);case"wrap":return e.setFlexWrap(r);case"padding":case"p":return e.setPadding(c.EDGE_ALL,t);case"paddingLeft":case"pl":return e.setPadding(c.EDGE_LEFT,t);case"paddingRight":case"pr":return e.setPadding(c.EDGE_RIGHT,t);case"paddingTop":case"pt":return e.setPadding(c.EDGE_TOP,t);case"paddingBottom":case"pb":return e.setPadding(c.EDGE_BOTTOM,t);case"margin":case"m":return e.setMargin(c.EDGE_ALL,t);case"marginLeft":case"ml":return e.setMargin(c.EDGE_LEFT,t);case"marginRight":case"mr":return e.setMargin(c.EDGE_RIGHT,t);case"marginTop":case"mt":return e.setMargin(c.EDGE_TOP,t);case"marginBottom":case"mb":return e.setMargin(c.EDGE_BOTTOM,t);default:return e[`set${d(i)}`](t)}}}));const u=e=>Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{})),h=n({scaleFactor:100,requestReflow(){console.warn("Flex not initialized! Please report")},registerBox(){console.warn("Flex not initialized! Please report")},unregisterBox(){console.warn("Flex not initialized! Please report")}}),f=n({node:null,size:[0,0]});function x(e){let t=i(e);return t||console.warn("You must place this hook/component under a <Flex/> component!"),t}function w(){const{requestReflow:e}=x(h);return e}function E(){const{size:e}=x(f);return e}function y({children:n,centerAnchor:i,flexDirection:l,flexDir:d,dir:m,alignContent:E,alignItems:y,alignSelf:b,align:C,justifyContent:D,justify:T,flexBasis:B,basis:R,flexGrow:L,grow:F,flexShrink:I,shrink:G,flexWrap:W,wrap:_,margin:k,m:P,marginBottom:v,marginLeft:j,marginRight:H,marginTop:M,mb:O,ml:S,mr:z,mt:A,padding:N,p:$,paddingBottom:q,paddingLeft:J,paddingRight:U,paddingTop:Y,pb:X,pl:K,pr:Q,pt:V,height:Z,width:ee,maxHeight:te,maxWidth:ne,minHeight:ie,minWidth:re,...ae}){const se=r((()=>{const e={flexDirection:l,flexDir:d,dir:m,alignContent:E,alignItems:y,alignSelf:b,align:C,justifyContent:D,justify:T,flexBasis:B,basis:R,flexGrow:L,grow:F,flexShrink:I,shrink:G,flexWrap:W,wrap:_,margin:k,m:P,marginBottom:v,marginLeft:j,marginRight:H,marginTop:M,mb:O,ml:S,mr:z,mt:A,padding:N,p:$,paddingBottom:q,paddingLeft:J,paddingRight:U,paddingTop:Y,pb:X,pl:K,pr:Q,pt:V,height:Z,width:ee,maxHeight:te,maxWidth:ne,minHeight:ie,minWidth:re};return u(e),e}),[C,E,y,b,m,B,R,d,l,L,F,I,G,W,Z,T,D,P,k,v,j,H,M,te,ne,O,ie,re,S,z,A,$,N,q,J,U,Y,X,K,Q,V,ee,_]),{registerBox:oe,unregisterBox:le,scaleFactor:ce}=x(h),{node:ge}=x(f),de=a(null),me=r((()=>c.Node.create()),[]),pe=w();s((()=>{p(me,se,ce)}),[se,me,ce]),s((()=>{if(de.current&&ge)return ge.insertChild(me,ge.getChildCount()),oe(me,de.current,se,i),()=>{ge.removeChild(me),le(me)}}),[me,ge,se,i,oe,le,n]),s((()=>{pe()}),[n,se,pe]);const[ue,he]=o([0,0]),fe=1/ce;s((()=>{const e=("number"==typeof se.width?se.width:null)||me.getComputedWidth().valueOf()/ce,t=("number"==typeof se.height?se.height:null)||me.getComputedHeight().valueOf()/ce;(Math.abs(e-ue[0])>fe||Math.abs(t-ue[1])>fe)&&he([e,t])}),[fe,se.height,se.width,me,ce,ue]);const xe=r((()=>({node:me,size:ue})),[me,ue]);return t.createElement(g,e({ref:de},ae),t.createElement(f.Provider,{value:xe},"function"==typeof n?n(ue[0],ue[1]):n))}function b({size:e=[1,1,1],yogaDirection:n="ltr",plane:i="xy",children:d,scaleFactor:m=100,onReflow:x,flexDirection:w,flexDir:E,dir:y,alignContent:b,alignItems:C,alignSelf:D,align:T,justifyContent:B,justify:R,flexBasis:L,basis:F,flexGrow:I,grow:G,flexShrink:W,shrink:_,flexWrap:k,wrap:P,margin:v,m:j,marginBottom:H,marginLeft:M,marginRight:O,marginTop:S,mb:z,ml:A,mr:N,mt:$,padding:q,p:J,paddingBottom:U,paddingLeft:Y,paddingRight:X,paddingTop:K,pb:Q,pl:V,pr:Z,pt:ee,height:te,width:ne,maxHeight:ie,maxWidth:re,minHeight:ae,minWidth:se,...oe}){const le=r((()=>{const e={flexDirection:w,flexDir:E,dir:y,alignContent:b,alignItems:C,alignSelf:D,align:T,justifyContent:B,justify:R,flexBasis:L,basis:F,flexGrow:I,grow:G,flexShrink:W,shrink:_,flexWrap:k,wrap:P,margin:v,m:j,marginBottom:H,marginLeft:M,marginRight:O,marginTop:S,mb:z,ml:A,mr:N,mt:$,padding:q,p:J,paddingBottom:U,paddingLeft:Y,paddingRight:X,paddingTop:K,pb:Q,pl:V,pr:Z,pt:ee,height:te,width:ne,maxHeight:ie,maxWidth:re,minHeight:ae,minWidth:se};return u(e),e}),[T,b,C,D,y,L,F,E,w,I,G,W,_,k,te,R,B,j,v,H,M,O,S,ie,re,z,ae,se,A,N,$,J,q,U,Y,X,K,Q,V,Z,ee,ne,P]),ce=a([]),ge=l(((e,t,n,i=!1)=>{const r=ce.current.findIndex((t=>t.node===e));-1!==r&&ce.current.splice(r,1),ce.current.push({group:t,node:e,flexProps:n,centerAnchor:i})}),[]),de=l((e=>{const t=ce.current.findIndex((t=>t.node===e));-1!==t&&ce.current.splice(t,1)}),[]),me=r((()=>c.Node.create()),[]);s((()=>{p(me,le,m)}),[me,le,m]);const[pe,ue]=o(0),he=l((()=>{console.log("Invalidate")}),[]),fe=l((()=>{he()}),[he,pe]);s((()=>{fe()}),[d,le,fe]);const[xe,we]=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(e,i),Ee="ltr"===n?c.DIRECTION_LTR:"rtl"===n?c.DIRECTION_RTL:n,ye=r((()=>({requestReflow:fe,registerBox:ge,unregisterBox:de,scaleFactor:m})),[fe,ge,de,m]),be=r((()=>({node:me,size:[xe,we]})),[me,xe,we]);return s((()=>{console.log("Running reflow callback"),function(){ce.current.forEach((({group:e,node:t,flexProps:n})=>{const i="number"==typeof n.width?n.width*m:n.width,r="number"==typeof n.height?n.height*m:n.height;if(void 0!==i&&void 0!==r)t.setWidth(i),t.setHeight(r);else if(0===t.getChildCount()){const n=e.getClientRect({skipTransform:!0});t.setWidth(i||n.width*m),t.setHeight(r||n.height*m)}})),me.calculateLayout(xe*m,we*m,Ee);let e=0,t=0,n=0,i=0;ce.current.forEach((({group:r,node:a,centerAnchor:s})=>{const{left:o,top:l,width:c,height:g}=a.getComputedLayout(),d={x:(o+(s?c/2:0))/m,y:(l+(s?g/2:0))/m};e=Math.min(e,o),n=Math.min(n,l),t=Math.max(t,o+c),i=Math.max(i,l+g),r.position(d)})),x&&x((t-e)/m,(i-n)/m),he()}()}),[d,le]),t.createElement(g,oe,t.createElement(h.Provider,{value:ye},t.createElement(f.Provider,{value:be},d)))}export{y as Box,b as Flex,x as useContext,E as useFlexSize,w as useReflow};
