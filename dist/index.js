import e from"@babel/runtime/helpers/esm/extends";import t,{createContext as n,useContext as i,useMemo as r,useRef as a,useLayoutEffect as s,useState as o,useCallback as l}from"react";import g from"yoga-layout-prebuilt";import{Group as c}from"react-konva";const d=e=>e[0].toUpperCase()+e.slice(1),m=e=>e.toUpperCase().replace("-","_"),p=(e,t,n)=>Object.keys(t).forEach((i=>{const r=t[i];if("string"==typeof r)switch(i){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(g[`FLEX_DIRECTION_${m(r)}`]);case"align":case"alignItems":return e.setAlignItems(g[`ALIGN_${m(r)}`]);case"justify":case"justifyContent":return e.setJustifyContent(g[`JUSTIFY_${m(r)}`]);case"wrap":case"flexWrap":return e.setFlexWrap(g[`WRAP_${m(r)}`]);case"basis":case"flexBasis":return e.setFlexBasis(r);default:return e[`set${d(i)}`](r)}else if("number"==typeof r){const t=r*n;switch(i){case"basis":case"flexBasis":return e.setFlexBasis(t);case"grow":case"flexGrow":return e.setFlexGrow(t);case"shrink":case"flexShrink":return e.setFlexShrink(t);case"align":return e.setAlignItems(r);case"justify":return e.setJustifyContent(r);case"flexDir":case"dir":return e.setFlexDirection(r);case"wrap":return e.setFlexWrap(r);case"padding":case"p":return e.setPadding(g.EDGE_ALL,t);case"paddingLeft":case"pl":return e.setPadding(g.EDGE_LEFT,t);case"paddingRight":case"pr":return e.setPadding(g.EDGE_RIGHT,t);case"paddingTop":case"pt":return e.setPadding(g.EDGE_TOP,t);case"paddingBottom":case"pb":return e.setPadding(g.EDGE_BOTTOM,t);case"margin":case"m":return e.setMargin(g.EDGE_ALL,t);case"marginLeft":case"ml":return e.setMargin(g.EDGE_LEFT,t);case"marginRight":case"mr":return e.setMargin(g.EDGE_RIGHT,t);case"marginTop":case"mt":return e.setMargin(g.EDGE_TOP,t);case"marginBottom":case"mb":return e.setMargin(g.EDGE_BOTTOM,t);default:return e[`set${d(i)}`](t)}}}));const u=e=>Object.keys(e).forEach((t=>void 0===e[t]?delete e[t]:{})),h=n({scaleFactor:100,requestReflow(){console.warn("Flex not initialized! Please report")},registerBox(){console.warn("Flex not initialized! Please report")},unregisterBox(){console.warn("Flex not initialized! Please report")}}),f=n({node:null,size:[0,0],rebuildFlag:0});function x(e){let t=i(e);return t||console.warn("You must place this hook/component under a <Flex/> component!"),t}function w(){const{requestReflow:e}=x(h);return e}function E(){const{size:e}=x(f);return e}function y({children:n,centerAnchor:i,flexDirection:l,flexDir:d,dir:m,alignContent:E,alignItems:y,alignSelf:b,align:D,justifyContent:C,justify:T,flexBasis:B,basis:F,flexGrow:R,grow:L,flexShrink:I,shrink:W,flexWrap:G,wrap:_,margin:k,m:P,marginBottom:v,marginLeft:H,marginRight:j,marginTop:M,mb:O,ml:S,mr:z,mt:A,padding:N,p:$,paddingBottom:q,paddingLeft:J,paddingRight:U,paddingTop:Y,pb:X,pl:K,pr:Q,pt:V,height:Z,width:ee,maxHeight:te,maxWidth:ne,minHeight:ie,minWidth:re,...ae}){const se=r((()=>{const e={flexDirection:l,flexDir:d,dir:m,alignContent:E,alignItems:y,alignSelf:b,align:D,justifyContent:C,justify:T,flexBasis:B,basis:F,flexGrow:R,grow:L,flexShrink:I,shrink:W,flexWrap:G,wrap:_,margin:k,m:P,marginBottom:v,marginLeft:H,marginRight:j,marginTop:M,mb:O,ml:S,mr:z,mt:A,padding:N,p:$,paddingBottom:q,paddingLeft:J,paddingRight:U,paddingTop:Y,pb:X,pl:K,pr:Q,pt:V,height:Z,width:ee,maxHeight:te,maxWidth:ne,minHeight:ie,minWidth:re};return u(e),e}),[D,E,y,b,m,B,F,d,l,R,L,I,W,G,Z,T,C,P,k,v,H,j,M,te,ne,O,ie,re,S,z,A,$,N,q,J,U,Y,X,K,Q,V,ee,_]),{registerBox:oe,unregisterBox:le,scaleFactor:ge}=x(h),{node:ce,rebuildFlag:de}=x(f),me=a(null),pe=r((()=>g.Node.create()),[]),ue=w();s((()=>{p(pe,se,ge)}),[se,pe,ge]),s((()=>{if(me.current&&ce)return ce.insertChild(pe,ce.getChildCount()),oe(pe,me.current,se,i),()=>{ce.removeChild(pe),le(pe)}}),[pe,ce,se,i,oe,le,de]),s((()=>{ue()}),[se,ue,de]);const[he,fe]=o([0,0]),xe=1/ge;s((()=>{const e=("number"==typeof se.width?se.width:null)||pe.getComputedWidth().valueOf()/ge,t=("number"==typeof se.height?se.height:null)||pe.getComputedHeight().valueOf()/ge;(Math.abs(e-he[0])>xe||Math.abs(t-he[1])>xe)&&fe([e,t])}),[xe,se.height,se.width,pe,ge,he]);const we=r((()=>({node:pe,size:he,rebuildFlag:Date.now()})),[pe,he,n]);return t.createElement(c,e({ref:me},ae),t.createElement(f.Provider,{value:we},"function"==typeof n?n(he[0],he[1]):n))}function b({size:e=[1,1,1],yogaDirection:n="ltr",plane:i="xy",children:d,scaleFactor:m=100,onReflow:x,flexDirection:w,flexDir:E,dir:y,alignContent:b,alignItems:D,alignSelf:C,align:T,justifyContent:B,justify:F,flexBasis:R,basis:L,flexGrow:I,grow:W,flexShrink:G,shrink:_,flexWrap:k,wrap:P,margin:v,m:H,marginBottom:j,marginLeft:M,marginRight:O,marginTop:S,mb:z,ml:A,mr:N,mt:$,padding:q,p:J,paddingBottom:U,paddingLeft:Y,paddingRight:X,paddingTop:K,pb:Q,pl:V,pr:Z,pt:ee,height:te,width:ne,maxHeight:ie,maxWidth:re,minHeight:ae,minWidth:se,...oe}){const le=r((()=>{const e={flexDirection:w,flexDir:E,dir:y,alignContent:b,alignItems:D,alignSelf:C,align:T,justifyContent:B,justify:F,flexBasis:R,basis:L,flexGrow:I,grow:W,flexShrink:G,shrink:_,flexWrap:k,wrap:P,margin:v,m:H,marginBottom:j,marginLeft:M,marginRight:O,marginTop:S,mb:z,ml:A,mr:N,mt:$,padding:q,p:J,paddingBottom:U,paddingLeft:Y,paddingRight:X,paddingTop:K,pb:Q,pl:V,pr:Z,pt:ee,height:te,width:ne,maxHeight:ie,maxWidth:re,minHeight:ae,minWidth:se};return u(e),e}),[T,b,D,C,y,R,L,E,w,I,W,G,_,k,te,F,B,H,v,j,M,O,S,ie,re,z,ae,se,A,N,$,J,q,U,Y,X,K,Q,V,Z,ee,ne,P]),ge=a([]),ce=l(((e,t,n,i=!1)=>{const r=ge.current.findIndex((t=>t.node===e));-1!==r&&ge.current.splice(r,1),ge.current.push({group:t,node:e,flexProps:n,centerAnchor:i})}),[]),de=l((e=>{const t=ge.current.findIndex((t=>t.node===e));-1!==t&&ge.current.splice(t,1)}),[]),me=r((()=>g.Node.create()),[]);s((()=>{p(me,le,m)}),[me,le,m]);const[pe,ue]=o(0),he=l((()=>{console.log("Invalidate")}),[]),fe=l((()=>{he()}),[he,pe]);s((()=>{fe()}),[d,le,fe]);const[xe,we]=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(e,i),Ee="ltr"===n?g.DIRECTION_LTR:"rtl"===n?g.DIRECTION_RTL:n,ye=r((()=>({requestReflow:fe,registerBox:ce,unregisterBox:de,scaleFactor:m})),[fe,ce,de,m]),be=r((()=>({node:me,size:[xe,we],rebuildFlag:Date.now()})),[me,xe,we,d]);return s((()=>{!function(){const e=Array(ge.current.length);ge.current.forEach((({group:t,node:n,flexProps:i},r)=>{const a="number"==typeof i.width?i.width*m:i.width,s="number"==typeof i.height?i.height*m:i.height;if(void 0!==a&&void 0!==s)n.setWidth(a),n.setHeight(s);else if(0===n.getChildCount()){const i=t.getClientRect({skipTransform:!0});e[r]=i,n.setWidth(a||i.width*m),n.setHeight(s||i.height*m)}else n.setWidth(NaN),n.setHeight(NaN)})),me.calculateLayout(xe*m,we*m,Ee);let t=0,n=0,i=0,r=0;ge.current.forEach((({group:a,node:s,centerAnchor:o},l)=>{const{left:g,top:c,width:d,height:p}=s.getComputedLayout();let u=0,h=0;const f=e[l];f&&(u=f.x,h=f.y);const x={x:(g+(o?d/2:0))/m,y:(c+(o?p/2:0))/m};x.x-=u,x.y-=h,t=Math.min(t,g),i=Math.min(i,c),n=Math.max(n,g+d),r=Math.max(r,c+p),a.position(x)})),x&&x((n-t)/m,(r-i)/m),he()}()}),[d,le]),t.createElement(c,oe,t.createElement(h.Provider,{value:ye},t.createElement(f.Provider,{value:be},d)))}export{y as Box,b as Flex,x as useContext,E as useFlexSize,w as useReflow};
