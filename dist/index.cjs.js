"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),t=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),n=require("react"),i=require("yoga-layout-prebuilt"),r=require("react-konva");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=a(e),s=a(t),u=a(n),l=a(i),f=function(e){return e[0].toUpperCase()+e.slice(1)},d=function(e){return e.toUpperCase().replace("-","_")},c=function(e,t,n){return Object.keys(t).forEach((function(i){var r=t[i];if("string"==typeof r)switch(i){case"flexDir":case"dir":case"flexDirection":return e.setFlexDirection(l.default["FLEX_DIRECTION_"+d(r)]);case"align":case"alignItems":return e.setAlignItems(l.default["ALIGN_"+d(r)]);case"justify":case"justifyContent":return e.setJustifyContent(l.default["JUSTIFY_"+d(r)]);case"wrap":case"flexWrap":return e.setFlexWrap(l.default["WRAP_"+d(r)]);case"basis":case"flexBasis":return e.setFlexBasis(r);default:return e["set"+f(i)](r)}else if("number"==typeof r){var a=r*n;switch(i){case"basis":case"flexBasis":return e.setFlexBasis(a);case"grow":case"flexGrow":return e.setFlexGrow(a);case"shrink":case"flexShrink":return e.setFlexShrink(a);case"align":return e.setAlignItems(r);case"justify":return e.setJustifyContent(r);case"flexDir":case"dir":return e.setFlexDirection(r);case"wrap":return e.setFlexWrap(r);case"padding":case"p":return e.setPadding(l.default.EDGE_ALL,a);case"paddingLeft":case"pl":return e.setPadding(l.default.EDGE_LEFT,a);case"paddingRight":case"pr":return e.setPadding(l.default.EDGE_RIGHT,a);case"paddingTop":case"pt":return e.setPadding(l.default.EDGE_TOP,a);case"paddingBottom":case"pb":return e.setPadding(l.default.EDGE_BOTTOM,a);case"margin":case"m":return e.setMargin(l.default.EDGE_ALL,a);case"marginLeft":case"ml":return e.setMargin(l.default.EDGE_LEFT,a);case"marginRight":case"mr":return e.setMargin(l.default.EDGE_RIGHT,a);case"marginTop":case"mt":return e.setMargin(l.default.EDGE_TOP,a);case"marginBottom":case"mb":return e.setMargin(l.default.EDGE_BOTTOM,a);default:return e["set"+f(i)](a)}}}))};var g=function(e){return Object.keys(e).forEach((function(t){return void 0===e[t]?delete e[t]:{}}))},p={scaleFactor:100,requestReflow:function(){console.warn("Flex not initialized! Please report")},registerBox:function(){console.warn("Flex not initialized! Please report")},unregisterBox:function(){console.warn("Flex not initialized! Please report")}},m=n.createContext(p),h={node:null,size:[0,0]},x=n.createContext(h);function w(e){var t=n.useContext(e);return t||console.warn("You must place this hook/component under a <Flex/> component!"),t}function y(){return w(m).requestReflow}var b=["children","centerAnchor","flexDirection","flexDir","dir","alignContent","alignItems","alignSelf","align","justifyContent","justify","flexBasis","basis","flexGrow","grow","flexShrink","shrink","flexWrap","wrap","margin","m","marginBottom","marginLeft","marginRight","marginTop","mb","ml","mr","mt","padding","p","paddingBottom","paddingLeft","paddingRight","paddingTop","pb","pl","pr","pt","height","width","maxHeight","maxWidth","minHeight","minWidth"];var v=["size","yogaDirection","plane","children","scaleFactor","onReflow","flexDirection","flexDir","dir","alignContent","alignItems","alignSelf","align","justifyContent","justify","flexBasis","basis","flexGrow","grow","flexShrink","shrink","flexWrap","wrap","margin","m","marginBottom","marginLeft","marginRight","marginTop","mb","ml","mr","mt","padding","p","paddingBottom","paddingLeft","paddingRight","paddingTop","pb","pl","pr","pt","height","width","maxHeight","maxWidth","minHeight","minWidth"];exports.Box=function(e){var t=e.children,i=e.centerAnchor,a=e.flexDirection,f=e.flexDir,d=e.dir,p=e.alignContent,h=e.alignItems,v=e.alignSelf,E=e.align,C=e.justifyContent,L=e.justify,B=e.flexBasis,D=e.basis,R=e.flexGrow,T=e.grow,W=e.flexShrink,k=e.shrink,F=e.flexWrap,G=e.wrap,I=e.margin,M=e.m,j=e.marginBottom,_=e.marginLeft,P=e.marginRight,S=e.marginTop,H=e.mb,O=e.ml,z=e.mr,A=e.mt,q=e.padding,N=e.p,J=e.paddingBottom,U=e.paddingLeft,Y=e.paddingRight,X=e.paddingTop,K=e.pb,Q=e.pl,V=e.pr,Z=e.pt,$=e.height,ee=e.width,te=e.maxHeight,ne=e.maxWidth,ie=e.minHeight,re=e.minWidth,ae=s.default(e,b),oe=n.useMemo((function(){var e={flexDirection:a,flexDir:f,dir:d,alignContent:p,alignItems:h,alignSelf:v,align:E,justifyContent:C,justify:L,flexBasis:B,basis:D,flexGrow:R,grow:T,flexShrink:W,shrink:k,flexWrap:F,wrap:G,margin:I,m:M,marginBottom:j,marginLeft:_,marginRight:P,marginTop:S,mb:H,ml:O,mr:z,mt:A,padding:q,p:N,paddingBottom:J,paddingLeft:U,paddingRight:Y,paddingTop:X,pb:K,pl:Q,pr:V,pt:Z,height:$,width:ee,maxHeight:te,maxWidth:ne,minHeight:ie,minWidth:re};return g(e),e}),[E,p,h,v,d,B,D,f,a,R,T,W,k,F,$,L,C,M,I,j,_,P,S,te,ne,H,ie,re,O,z,A,N,q,J,U,Y,X,K,Q,V,Z,ee,G]),se=w(m),ue=se.registerBox,le=se.unregisterBox,fe=se.scaleFactor,de=w(x).node,ce=n.useRef(null),ge=n.useMemo((function(){return l.default.Node.create()}),[]),pe=y();n.useLayoutEffect((function(){c(ge,oe,fe)}),[oe,ge,fe]),n.useLayoutEffect((function(){if(ce.current&&de)return de.insertChild(ge,de.getChildCount()),ue(ge,ce.current,oe,i),function(){de.removeChild(ge),le(ge)}}),[ge,de,oe,i,ue,le,t]),n.useLayoutEffect((function(){pe()}),[t,oe,pe]);var me=n.useState([0,0]),he=me[0],xe=me[1],we=1/fe;n.useLayoutEffect((function(){var e=("number"==typeof oe.width?oe.width:null)||ge.getComputedWidth().valueOf()/fe,t=("number"==typeof oe.height?oe.height:null)||ge.getComputedHeight().valueOf()/fe;(Math.abs(e-he[0])>we||Math.abs(t-he[1])>we)&&xe([e,t])}),[we,oe.height,oe.width,ge,fe,he]);var ye=n.useMemo((function(){return{node:ge,size:he}}),[ge,he]);return u.default.createElement(r.Group,o.default({ref:ce},ae),u.default.createElement(x.Provider,{value:ye},"function"==typeof t?t(he[0],he[1]):t))},exports.Flex=function(e){var t=e.size,i=void 0===t?[1,1,1]:t,a=e.yogaDirection,o=void 0===a?"ltr":a,f=e.plane,d=void 0===f?"xy":f,p=e.children,h=e.scaleFactor,w=void 0===h?100:h,y=e.onReflow,b=e.flexDirection,E=e.flexDir,C=e.dir,L=e.alignContent,B=e.alignItems,D=e.alignSelf,R=e.align,T=e.justifyContent,W=e.justify,k=e.flexBasis,F=e.basis,G=e.flexGrow,I=e.grow,M=e.flexShrink,j=e.shrink,_=e.flexWrap,P=e.wrap,S=e.margin,H=e.m,O=e.marginBottom,z=e.marginLeft,A=e.marginRight,q=e.marginTop,N=e.mb,J=e.ml,U=e.mr,Y=e.mt,X=e.padding,K=e.p,Q=e.paddingBottom,V=e.paddingLeft,Z=e.paddingRight,$=e.paddingTop,ee=e.pb,te=e.pl,ne=e.pr,ie=e.pt,re=e.height,ae=e.width,oe=e.maxHeight,se=e.maxWidth,ue=e.minHeight,le=e.minWidth,fe=s.default(e,v),de=n.useMemo((function(){var e={flexDirection:b,flexDir:E,dir:C,alignContent:L,alignItems:B,alignSelf:D,align:R,justifyContent:T,justify:W,flexBasis:k,basis:F,flexGrow:G,grow:I,flexShrink:M,shrink:j,flexWrap:_,wrap:P,margin:S,m:H,marginBottom:O,marginLeft:z,marginRight:A,marginTop:q,mb:N,ml:J,mr:U,mt:Y,padding:X,p:K,paddingBottom:Q,paddingLeft:V,paddingRight:Z,paddingTop:$,pb:ee,pl:te,pr:ne,pt:ie,height:re,width:ae,maxHeight:oe,maxWidth:se,minHeight:ue,minWidth:le};return g(e),e}),[R,L,B,D,C,k,F,E,b,G,I,M,j,_,re,W,T,H,S,O,z,A,q,oe,se,N,ue,le,J,U,Y,K,X,Q,V,Z,$,ee,te,ne,ie,ae,P]),ce=n.useRef([]),ge=n.useCallback((function(e,t,n,i){void 0===i&&(i=!1);var r=ce.current.findIndex((function(t){return t.node===e}));-1!==r&&ce.current.splice(r,1),ce.current.push({group:t,node:e,flexProps:n,centerAnchor:i})}),[]),pe=n.useCallback((function(e){var t=ce.current.findIndex((function(t){return t.node===e}));-1!==t&&ce.current.splice(t,1)}),[]),me=n.useMemo((function(){return l.default.Node.create()}),[]);n.useLayoutEffect((function(){c(me,de,w)}),[me,de,w]);var he=n.useState(0),xe=he[0];he[1];var we=n.useCallback((function(){console.log("Invalidate")}),[]),ye=n.useCallback((function(){we()}),[we,xe]);n.useLayoutEffect((function(){ye()}),[p,de,ye]);var be=function(e,t){switch(t){case"xy":return[e[0],e[1]];case"yz":return[e[1],e[2]];case"xz":return[e[0],e[2]]}}(i,d),ve=be[0],Ee=be[1],Ce="ltr"===o?l.default.DIRECTION_LTR:"rtl"===o?l.default.DIRECTION_RTL:o,Le=n.useMemo((function(){return{requestReflow:ye,registerBox:ge,unregisterBox:pe,scaleFactor:w}}),[ye,ge,pe,w]),Be=n.useMemo((function(){return{node:me,size:[ve,Ee]}}),[me,ve,Ee]);return n.useLayoutEffect((function(){console.log("Running reflow callback"),function(){ce.current.forEach((function(e){var t=e.group,n=e.node,i=e.flexProps,r="number"==typeof i.width?i.width*w:i.width,a="number"==typeof i.height?i.height*w:i.height;if(void 0!==r&&void 0!==a)n.setWidth(r),n.setHeight(a);else if(0===n.getChildCount()){var o=t.getClientRect({skipTransform:!0});n.setWidth(r||o.width*w),n.setHeight(a||o.height*w)}})),me.calculateLayout(ve*w,Ee*w,Ce);var e=0,t=0,n=0,i=0;ce.current.forEach((function(r){var a=r.group,o=r.node,s=r.centerAnchor,u=o.getComputedLayout(),l=u.left,f=u.top,d=u.width,c=u.height,g={x:(l+(s?d/2:0))/w,y:(f+(s?c/2:0))/w};e=Math.min(e,l),n=Math.min(n,f),t=Math.max(t,l+d),i=Math.max(i,f+c),a.position(g)})),y&&y((t-e)/w,(i-n)/w),we()}()}),[p,de]),u.default.createElement(r.Group,fe,u.default.createElement(m.Provider,{value:Le},u.default.createElement(x.Provider,{value:Be},p)))},exports.useContext=w,exports.useFlexSize=function(){return w(x).size},exports.useReflow=y;
